<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Registration</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>
<div class="lbx">
    <div class="sbx content">
        <h2 class="header1">Create Account</h2>
        <p class="header2">Enter your access credentials</p>

        {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            {% for category, message in messages %}
                <div class="flash {{ category }}">{{ message }}</div>
            {% endfor %}
        {% endif %}
        {% endwith %}

        <form action="{{ url_for('register') }}" method="POST">
            <div class="fg">
                <label for="username">Username</label>
                <input type="text" id="username" name="username" required>
            </div>

            <div class="fg">
                <label for="birthday">Birthday</label>
                <input type="date" id="birthday" name="birthday" required>
                <span id="age-display" class="age-display" aria-live="polite">Age: Not calculated yet</span>
            </div>

            <div class="fg">
                <label for="email">Email</label>
                <input type="email" id="email" name="email" required>
            </div>

            <div class="fg">
                <label for="password">Password</label>
                <input type="password" id="password" name="password" required>
            </div>

            <div class="fg">
                <label for="confirm_password">Confirm Password</label>
                <input type="password" id="confirm_password" name="confirm_password" required>
            </div>

            <button class="submit" type="submit">Register</button>
        </form>
    </div>
</div>
<div class="footer">
    <a href="/">Home</a> | <a href="/users">View Users</a>
</div>

<script>
    document.getElementById('birthday').addEventListener('change', function() {
        const birthdayInput = this.value;
        const ageDisplay = document.getElementById('age-display');
        
        if (!birthdayInput) {
            ageDisplay.textContent = 'Age: Not calculated yet';
            return;
        }
        
        const birthday = new Date(birthdayInput);
        const today = new Date();
        
        if (birthday > today) {
            ageDisplay.textContent = 'Invalid birthday';
            return;
        }
        
        let age = today.getFullYear() - birthday.getFullYear();
        const monthDiff = today.getMonth() - birthday.getMonth();
        const dayDiff = today.getDate() - birthday.getDate();
        
        if (monthDiff < 0 || (monthDiff === 0 && dayDiff < 0)) {
            age--;
        }
        
        ageDisplay.textContent = `Age: ${age}`;
    });
</script>
</body>
</html>
